# Data Model: Silver Tier Enhancement

## Overview
This document defines the data structures and entities for the Silver Tier Enhancement of the Personal AI Employee system.

## Core Entities

### 1. Watcher Event
**Description**: Represents an event detected by a watcher that requires AI attention

**Fields**:
- `id`: Unique identifier for the event
- `source`: Source of the event (gmail, linkedin, file_system, etc.)
- `timestamp`: When the event was detected
- `event_type`: Type of event (email_received, file_added, social_post, etc.)
- `data`: Raw data payload from the source
- `processed`: Boolean indicating if AI has processed this event
- `related_file`: Path to any related file in the vault

**State Transitions**:
- `detected` → `processing` → `processed` | `error`

### 2. Plan.md
**Description**: Structured document containing reasoning and action steps generated by Claude

**Fields**:
- `title`: Descriptive title of the plan
- `status`: Current status (draft, pending_approval, approved, rejected, executing, completed, failed)
- `created_at`: Timestamp when plan was created
- `updated_at`: Timestamp when plan was last updated
- `situation`: Description of the situation requiring action
- `reasoning`: Claude's reasoning for the proposed approach
- `steps`: Ordered list of steps to execute
- `expected_outcomes`: Anticipated results of the plan
- `success_criteria`: How to measure if the plan was successful
- `dependencies`: Other plans or resources required
- `estimated_duration`: Estimated time to complete
- `risk_level`: Risk classification (low, medium, high)
- `approval_required`: Whether human approval is needed
- `assigned_to`: Who is responsible for execution (AI or human)

**State Transitions**:
- `draft` → `pending_approval` → `approved` | `rejected`
- `approved` → `executing` → `completed` | `failed`

### 3. Approval Request
**Description**: Structured request requiring human approval for sensitive actions

**Fields**:
- `id`: Unique identifier for the approval request
- `request_type`: Type of action requiring approval
- `title`: Brief description of the request
- `description`: Detailed description of what will happen
- `tier`: Approval tier (0, 1, 2, 3)
- `created_at`: When the request was created
- `expires_at`: When the request will timeout
- `submitted_by`: Who submitted the request (AI or human)
- `status`: Current status (pending, approved, rejected, expired)
- `approver`: Who approved or rejected the request
- `approved_at`: When the approval happened
- `rejection_reason`: Reason if the request was rejected
- `related_plan`: Link to the plan this request is part of
- `risk_assessment`: Risk evaluation for this action

**State Transitions**:
- `pending` → `approved` | `rejected` | `expired`

### 4. Agent Skill
**Description**: Modular, self-contained capability that performs specific functions

**Fields**:
- `name`: Unique name for the skill
- `description`: What the skill does
- `input_format`: Expected input structure and types
- `output_format`: Expected output structure and types
- `error_handling`: How errors are handled
- `approval_required`: Whether human approval is needed for this skill
- `version`: Current version of the skill
- `author`: Who created the skill
- `created_at`: When the skill was created
- `updated_at`: When the skill was last updated
- `dependencies`: Other skills or services this skill depends on
- `success_rate`: Historical success rate of this skill
- `execution_time_avg`: Average execution time

### 5. MCP Server Request
**Description**: Request sent to an MCP server for external action execution

**Fields**:
- `id`: Unique identifier for the request
- `server_type`: Type of MCP server (email, linkedin, browser, etc.)
- `action`: Specific action to perform
- `parameters`: Parameters for the action
- `created_at`: When the request was created
- `sent_at`: When the request was sent to the server
- `completed_at`: When the request was completed
- `status`: Current status (pending, sent, completed, failed, timeout)
- `response`: Response from the server
- `error`: Error details if the request failed
- `retry_count`: Number of retry attempts
- `initiated_by`: What initiated this request (which plan or event)

**State Transitions**:
- `pending` → `sent` → `completed` | `failed`
- `failed` → `retrying` → `completed` | `failed` (max retries reached)

### 6. Scheduled Task
**Description**: Task configured to run on a schedule

**Fields**:
- `id`: Unique identifier for the task
- `name`: Descriptive name for the task
- `schedule`: Cron expression or schedule specification
- `task_type`: Type of task (health_check, linkedin_post, ceo_briefing, etc.)
- `enabled`: Whether the task is currently enabled
- `last_run`: When the task was last executed
- `next_run`: When the task is scheduled to run next
- `created_at`: When the task was created
- `updated_at`: When the task was last modified
- `created_by`: Who created the task (human or AI)
- `execution_count`: Number of times the task has run
- `success_count`: Number of successful executions
- `failure_count`: Number of failed executions
- `last_result`: Result of the last execution

## Relationships

### Watcher Event → Plan.md
- One Watcher Event can trigger the creation of one or more Plan.md files
- Many-to-one relationship when multiple events contribute to a single plan

### Plan.md → Approval Request
- One Plan.md can generate zero or more Approval Requests
- Required when plan involves actions that need human approval

### Approval Request → Plan.md
- One Approval Request is associated with one Plan.md
- Approval request contains subset of plan for review

### Agent Skill → Plan.md
- One Plan.md can utilize multiple Agent Skills
- Skills execute the steps defined in the plan

### Plan.md → MCP Server Request
- One Plan.md execution can generate multiple MCP Server Requests
- Each external action requires a separate server request

### Scheduled Task → Plan.md
- One Scheduled Task can generate Plan.md files periodically
- Examples: daily health checks, weekly LinkedIn posts, CEO briefings

## Validation Rules

### Plan.md Validation
- `title` is required and must be 3-100 characters
- `situation` is required and must be 10-1000 characters
- `steps` must contain at least one step
- `success_criteria` must be specific and measurable
- `risk_level` must be one of: low, medium, high

### Approval Request Validation
- `request_type` is required
- `title` is required and must be 3-100 characters
- `tier` must be 0, 1, 2, or 3
- `expires_at` must be in the future
- `status` must be one of: pending, approved, rejected, expired

### Agent Skill Validation
- `name` is required and must be unique
- `description` is required
- `input_format` and `output_format` must be valid JSON schema

### MCP Server Request Validation
- `server_type` is required
- `action` is required
- `status` must be one of: pending, sent, completed, failed, timeout

## File-Based Storage Mapping

### Watcher Events
Stored as individual files in `AI_Employee_Vault/Inbox/` with naming convention `{timestamp}_{source}_{id}.md`

### Plan.md Files
Stored in `AI_Employee_Vault/Plans/` with naming convention `{timestamp}_{title_slug}.md`

### Approval Requests
Represented as files in `AI_Employee_Vault/Pending_Approval/` with naming convention `{timestamp}_{request_type}_{id}.md`

### Execution Logs
Stored in `AI_Employee_Vault/Logs/YYYY-MM-DD_execution_log.json` for each day

## Access Patterns

1. **Event Processing**: Watchers write to Inbox, AI reads from Inbox
2. **Plan Creation**: AI creates Plan.md files in Plans folder
3. **Approval Workflow**: Plans move from Plans to Pending_Approval to Approved/Rejected
4. **Scheduled Execution**: Scheduler triggers Plan creation at scheduled intervals
5. **Audit Trail**: All actions logged to execution logs for review